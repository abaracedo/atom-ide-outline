"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("atom");function e(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var o=e(t);function i(t){atom.notifications.addError(t.name,{stack:t.stack,detail:t.message})}class n{constructor(){this.pointToElementsMap=new Map,this.element=document.createElement("div"),this.element.classList.add("outline-view")}destroy(){this.element.remove()}getElement(){return this.element}getTitle(){return"Outline"}getIconName(){return"list-unordered"}setOutline(t,e,o){const i=this.clearOutline();if(i.dataset.editorRootScope=e.getRootScopeDescriptor().getScopesArray().join(" "),o){const t=document.createElement("div");t.innerHTML='\n        <span style = "\n          font-size: var(--editor-font-size);\n          font-family: var(--editor-font-family);\n          line-height: var(--editor-line-height);\n          color: #71844c;\n        "\n        >Large file mode</span>\n      ',i.appendChild(t)}const n=document.createElement("ul"),r=e.getTabLength();"number"==typeof r&&n.style.setProperty("--editor-tab-length",Math.max(r/2,2).toString(10)),s(n,t,e,this.pointToElementsMap,o||atom.config.get("atom-ide-outline.foldInitially")),i.appendChild(n)}clearOutline(){const t=this.getElement();return t.innerHTML="",t.dataset.editorRootScope="",t}presentStatus(t){this.clearOutline();const e=t&&function(t){const e=document.createElement("div");e.className="status";const{title:o="",description:i=""}=t;return e.innerHTML=`<h1>${o}</h1>\n  <span>${i}</span>`,e}(t);if(e){this.getElement().appendChild(e)}}selectAtCursorLine(t){if(!this.isVisible())return;if(r)return void(r=!1);if(void 0!==this.focusedElms)for(const t of this.focusedElms)t.toggleAttribute("cursorOn",!1);const e=t.row;if(this.focusedElms=this.pointToElementsMap.get(e),void 0!==this.focusedElms)for(const t of this.focusedElms)t.toggleAttribute("cursorOn",!0),t.scrollIntoView({block:"center"})}isVisible(){return function(t){const e=atom.workspace.paneContainerForItem(t);return void 0!==e&&("function"!=typeof e.isVisible||e.isVisible())}(this)}}let r=!1;function s(t,e,o,i,n,d=0){var c;atom.config.get("atom-ide-outline.sortEntries")&&e.sort(((t,e)=>{const o=t.startPosition.row-e.startPosition.row;return 0===o?t.startPosition.column-t.startPosition.column:o}));for(const u of e){const e=document.createElement("li"),f=document.createElement("span");f.innerText=null!==(c=u.representativeName||u.plainText)&&void 0!==c?c:"",f.prepend(a(null==u?void 0:u.icon,null==u?void 0:u.kind)),e.appendChild(f);const p=i.get(u.startPosition.row);if(void 0!==p?(p.push(e),i.set(u.startPosition.row,p)):i.set(u.startPosition.row,[e]),e.addEventListener("click",(()=>{const t=atom.workspace.paneForItem(o);t&&(t.activate(),o.getCursors()[0].setBufferPosition(u.startPosition,{autoscroll:!0}),r=!0)}),{passive:!0}),null!=u.children&&null!=u.children[0]){const t=document.createElement("ul");t.style.setProperty("--indent-level",(d+1).toString(10)),t.addEventListener("click",(t=>t.stopPropagation()),{passive:!0}),e.appendChild(t);const r=l(t,n);f.prepend(r),s(t,u.children,o,i,n,d+1)}t.appendChild(e)}}function a(t,e){const o=document.createElement("span");o.classList.add("outline-icon"),null==e&&null!=t&&(e=t);let i="ðŸž‡";if("string"==typeof e&&e.length>0){let t;0===e.indexOf("type-")?(t=`${e}`,i=e.replace("type-","")):(t=`type-${e}`,i=e),o.classList.add(t)}return o.innerHTML=`<span>${i.substring(0,3)}</span>`,o}function l(t,e){const o=document.createElement("button");return e?(t.hidden=!0,o.classList.add("outline-fold-btn","collapsed")):o.classList.add("outline-fold-btn","expanded"),o.addEventListener("click",(e=>{t.hidden=!t.hidden,t.hidden?(o.classList.remove("expanded"),o.classList.add("collapsed")):(o.classList.remove("collapsed"),o.classList.add("expanded")),e.stopPropagation()}),{passive:!0}),o}var d="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var c,u=(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.ProviderRegistry=void 0,e.ProviderRegistry=class{constructor(){this.providers=[]}addProvider(t){const e=this.providers.findIndex((e=>t.priority>e.priority));return-1===e?this.providers.push(t):this.providers.splice(e,0,t),new o.default.Disposable((()=>{this.removeProvider(t)}))}removeProvider(t){const e=this.providers.indexOf(t);-1!==e&&this.providers.splice(e,1)}getProviderForEditor(t){const e=t.getGrammar().scopeName;return this.findProvider(e)}getAllProvidersForEditor(t){const e=t.getGrammar().scopeName;return this.findAllProviders(e)}findProvider(t){for(const e of this.findAllProviders(t))return e;return null}*findAllProviders(t){for(const e of this.providers)null!=e.grammarScopes&&-1===e.grammarScopes.indexOf(t)||(yield e)}}}(c={exports:{}},c.exports),c.exports);const f={noEditor:{title:"Outline is unavailable.",description:"Open a text editor."},noProvider:{title:"Provider is unavailable",description:"Looks like a provider for this type of file is not available. Check if a relevant IDE language package is installed and has outline support, or try adding one from Atom's package registry (e.g.: atom-ide-javascript, atom-typescript, ide-python, ide-rust, ide-css, ide-json)."}};var p=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)},v="object"==typeof d&&d&&d.Object===Object&&d,m="object"==typeof self&&self&&self.Object===Object&&self,g=v||m||Function("return this")(),h=function(){return g.Date.now()},y=/\s/;var b=function(t){for(var e=t.length;e--&&y.test(t.charAt(e)););return e},w=/^\s+/;var E=function(t){return t?t.slice(0,b(t)+1).replace(w,""):t},P=g.Symbol,x=Object.prototype,O=x.hasOwnProperty,T=x.toString,L=P?P.toStringTag:void 0;var k=function(t){var e=O.call(t,L),o=t[L];try{t[L]=void 0;var i=!0}catch(t){}var n=T.call(t);return i&&(e?t[L]=o:delete t[L]),n},j=Object.prototype.toString;var S=function(t){return j.call(t)},C=P?P.toStringTag:void 0;var A=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":C&&C in Object(t)?k(t):S(t)};var I=function(t){return null!=t&&"object"==typeof t};var M=function(t){return"symbol"==typeof t||I(t)&&"[object Symbol]"==A(t)},D=/^[-+]0x[0-9a-f]+$/i,F=/^0b[01]+$/i,N=/^0o[0-7]+$/i,R=parseInt;var $=function(t){if("number"==typeof t)return t;if(M(t))return NaN;if(p(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=p(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=E(t);var o=F.test(t);return o||N.test(t)?R(t.slice(2),o?2:8):D.test(t)?NaN:+t},V=Math.max,B=Math.min;var H=function(t,e,o){var i,n,r,s,a,l,d=0,c=!1,u=!1,f=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function v(e){var o=i,r=n;return i=n=void 0,d=e,s=t.apply(r,o)}function m(t){return d=t,a=setTimeout(y,e),c?v(t):s}function g(t){var o=t-l;return void 0===l||o>=e||o<0||u&&t-d>=r}function y(){var t=h();if(g(t))return b(t);a=setTimeout(y,function(t){var o=e-(t-l);return u?B(o,r-(t-d)):o}(t))}function b(t){return a=void 0,f&&i?v(t):(i=n=void 0,s)}function w(){var t=h(),o=g(t);if(i=arguments,n=this,l=t,o){if(void 0===a)return m(l);if(u)return clearTimeout(a),a=setTimeout(y,e),v(l)}return void 0===a&&(a=setTimeout(y,e)),s}return e=$(e)||0,p(o)&&(c=!!o.leading,r=(u="maxWait"in o)?V($(o.maxWait)||0,e):r,f="trailing"in o?!!o.trailing:f),w.cancel=function(){void 0!==a&&clearTimeout(a),d=0,i=l=n=a=void 0},w.flush=function(){return void 0===a?s:b(h())},w},_={initialDisplay:{title:"Initial Outline Display",description:"Show outline initially aftern atom loads",type:"boolean",default:!0},sortEntries:{title:"Sort entries based on the line number",description:"This option sorts the entries based on where they appear in the code.",type:"boolean",default:!0},foldInitially:{title:"Fold the entries initially",description:"If enabled, the outline entries are folded initially. This is enabled automatically in large file mode.",type:"boolean",default:!1}};const z=new t.CompositeDisposable;let G;const W=new u.ProviderRegistry;const q=atom.config.get("linter-ui-default.longLineLength")||4e3,U=atom.config.get("linter-ui-default.largeFileLineCount")/6||3e3;function J(t){if(t.largeFileMode)return 2e4;const e=t.getLineCount();if(e>=U)return e;{const o=t.getBuffer();for(let t=0,i=e;t<i;t++)if(o.lineLengthForRow(t)>q)return q;return 0}}let K;async function Q(t){var e;if(void 0===t)return;null===(e=null==K?void 0:K.dispose)||void 0===e||e.call(K),await Z(t);const o=J(t),i=Math.max(o/5,300),n=H(Z,i);K.add(t.onDidStopChanging((async()=>{await n(t)})),t.onDidDestroy((()=>{tt("noEditor")})))}function X(){const t=atom.workspace.getActiveTextEditor();void 0!==t&&void 0!==G&&G.selectAtCursorLine(t.getCursorBufferPosition())}async function Y(){void 0===G&&(G=new n);const t=atom.workspace.paneForItem(G);if(t)return void t.destroyItem(G);const e=atom.workspace.getRightDock(),[o]=e.getPanes();o.addItem(G),o.activateItem(G),e.show();try{await Q(atom.workspace.getActiveTextEditor())}catch(t){i(t)}}async function Z(t=atom.workspace.getActiveTextEditor()){var e;if(void 0===G&&(G=new n),!G.isVisible())return;if(void 0===t)return tt("noEditor");const o=W.getProviderForEditor(t);if(!o)return tt("noProvider");const i=await o.getOutline(t);G.setOutline(null!==(e=null==i?void 0:i.outlineTrees)&&void 0!==e?e:[],t,Boolean(J(t)))}function tt(t){null==G||G.presentStatus(f[t])}exports.activate=function(){z.add(atom.commands.add("atom-workspace","outline:toggle",Y),atom.commands.add("atom-workspace","outline:reveal-cursor",X)),function(){K=new t.CompositeDisposable;const e=atom.workspace.observeActiveTextEditor(Q);z.add(e)}(),atom.config.get("atom-ide-outline.initialDisplay")&&Y().catch((t=>{i(t)}))},exports.config=_,exports.consumeOutlineProvider=async function(t){z.add(W.addProvider(t)),await Z()},exports.deactivate=function(){var t;null===(t=null==K?void 0:K.dispose)||void 0===t||t.call(K),z.dispose(),null==G||G.destroy(),G=void 0},exports.getOutline=Z,exports.outlineProviderRegistry=W,exports.revealCursor=X,exports.setStatus=tt,exports.statuses=f,exports.toggleOutlineView=Y;
//# sourceMappingURL=main.js.map
