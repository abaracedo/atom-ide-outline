"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("atom");function e(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var n=e(t);function i(t){atom.notifications.addError(t.name,{stack:t.stack,detail:t.message})}class o{constructor(){this.outlineList=void 0,this.pointToElementsMap=new Map,this.element=document.createElement("div"),this.element.classList.add("atom-ide-outline"),this.element.appendChild(function(){const t=document.createElement("span");t.className="outline-toolbar";const e=document.createElement("button");return e.innerHTML="Reveal Cursor",e.className="btn outline-btn",e.addEventListener("click",(()=>{atom.commands.dispatch(atom.views.getView(atom.workspace),"outline:reveal-cursor")})),t.appendChild(e),t}()),this.outlineContent=document.createElement("div"),this.element.appendChild(this.outlineContent),this.outlineContent.classList.add("outline-content")}destroy(){this.element.remove()}getElement(){return this.element}getTitle(){return"Outline"}getIconName(){return"list-unordered"}setOutline(t,e,n){if(void 0!==this.lastEntries&&r(t,this.lastEntries))return this.pointToElementsMap.clear(),void l(this.outlineList,t,e,this.pointToElementsMap);this.lastEntries=t,this.clearContent(),n&&this.outlineContent.appendChild(function(){const t=document.createElement("div");return t.innerHTML='<span class="large-file-mode">Large file mode</span>',t}()),this.outlineList=function(t,e,n,i){const o=document.createElement("ul");o.dataset.editorRootScope=e.getRootScopeDescriptor().getScopesArray().join(" ");const r=e.getTabLength();"number"==typeof r&&o.style.setProperty("--editor-tab-length",Math.max(r/2,2).toString(10));return a(o,t,e,n||atom.config.get("atom-ide-outline.foldInitially"),0),l(o,t,e,i),o}(t,e,n,this.pointToElementsMap),this.outlineContent.appendChild(this.outlineList)}clearContent(){this.outlineContent.innerHTML="",void 0!==this.outlineList&&(this.outlineList.dataset.editorRootScope=""),this.lastEntries=void 0}presentStatus(t){this.clearContent();const e=t&&function(t){const e=document.createElement("div");e.className="status";const{title:n="",description:i=""}=t;return e.innerHTML=`<h1>${n}</h1>\n  <span>${i}</span>`,e}(t);e&&this.outlineContent.appendChild(e)}selectAtCursorLine(t){const e=t.getLastCursor();if(!e)return;if(!this.isVisible())return;if(c)return void(c=!1);if(void 0!==this.focusedElms)for(const t of this.focusedElms)t.toggleAttribute("cursorOn",!1);const n=e.getBufferRow();if(this.focusedElms=this.pointToElementsMap.get(n),void 0!==this.focusedElms){for(const t of this.focusedElms)t.scrollIntoViewIfNeeded(!0),t.toggleAttribute("cursorOn",!0);const e=t.onDidChangeCursorPosition((()=>{if(void 0!==this.focusedElms)for(const t of this.focusedElms)t.toggleAttribute("cursorOn",!1);e.dispose()}))}}isVisible(){return function(t){const e=atom.workspace.paneContainerForItem(t);return void 0!==e&&("function"!=typeof e.isVisible||e.isVisible())}(this)}}function r(t,e){if(t===e)return!0;{const n=t.length;if(n!==e.length)return!1;for(let i=0;i<n;i++){const n=t[i],o=e[i];if(n.representativeName!==o.representativeName||n.plainText!==o.plainText||n.kind!==o.kind||n.icon!==o.icon||!r(n.children,o.children))return!1}}return!0}function s(t){return t.children.length>=1}function a(t,e,n,i,o){var r;!function(t){atom.config.get("atom-ide-outline.sortEntries")&&t.sort(((t,e)=>{const n=t.startPosition.row-e.startPosition.row;return 0===n?t.startPosition.column-t.startPosition.column:n}))}(e);for(const l of e){const e=document.createElement("li"),d=document.createElement("span");if(d.innerText=null!==(r=l.representativeName||l.plainText)&&void 0!==r?r:"",d.prepend(p(null==l?void 0:l.icon,null==l?void 0:l.kind)),e.appendChild(d),s(l)){const t=document.createElement("ul");t.style.setProperty("--indent-level",(o+1).toString(10)),t.addEventListener("click",(t=>t.stopPropagation()),{passive:!0}),e.appendChild(t);const r=f(t,i);d.prepend(r),a(t,l.children,n,i,o+1)}t.appendChild(e)}}function l(t,e,n,i,o){const r=t.children;for(let t=0,o=e.length;t<o;t++){const o=e[t],a=r[t];if(a.addEventListener("click",(()=>u(o.startPosition,n)),{passive:!0}),d(i,o.startPosition.row,a),s(o)){l(a.lastElementChild,o.children,n,i)}}}function d(t,e,n){const i=t.get(e);void 0!==i?(i.push(n),t.set(e,i)):t.set(e,[n])}let c=!1;function u(t,e){const n=atom.workspace.paneForItem(e);void 0!==n&&(n.activate(),e.getCursors()[0].setBufferPosition(t,{autoscroll:!0}),c=!0)}function p(t,e){const n=document.createElement("span");n.classList.add("outline-icon"),void 0===e&&void 0!==t&&(e=t);let i="ðŸž‡";if("string"==typeof e&&e.length>0){let t;0===e.indexOf("type-")?(t=""+e,i=e.replace("type-","")):(t="type-"+e,i=e),n.classList.add(t)}return n.innerHTML=`<span>${i.substring(0,3)}</span>`,n}function f(t,e){const n=document.createElement("button");return e?(t.hidden=!0,n.classList.add("outline-fold-btn","collapsed")):n.classList.add("outline-fold-btn","expanded"),n.addEventListener("click",(e=>{t.hidden=!t.hidden,t.hidden?(n.classList.remove("expanded"),n.classList.add("collapsed")):(n.classList.remove("collapsed"),n.classList.add("expanded")),e.stopPropagation()}),{passive:!0}),n}var v="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var m,h=(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.ProviderRegistry=void 0,e.ProviderRegistry=class{constructor(){this.providers=[]}addProvider(t){const e=this.providers.findIndex((e=>t.priority>e.priority));return-1===e?this.providers.push(t):this.providers.splice(e,0,t),new n.default.Disposable((()=>{this.removeProvider(t)}))}removeProvider(t){const e=this.providers.indexOf(t);-1!==e&&this.providers.splice(e,1)}getProviderForEditor(t){const e=t.getGrammar().scopeName;return this.findProvider(e)}getAllProvidersForEditor(t){const e=t.getGrammar().scopeName;return this.findAllProviders(e)}findProvider(t){for(const e of this.findAllProviders(t))return e;return null}*findAllProviders(t){for(const e of this.providers)null!=e.grammarScopes&&-1===e.grammarScopes.indexOf(t)||(yield e)}}}(m={exports:{}},m.exports),m.exports);const g={noEditor:{title:"Outline is unavailable.",description:"Open a text editor."},noProvider:{title:"Provider is unavailable",description:"Looks like a provider for this type of file is not available. Check if a relevant IDE language package is installed and has outline support, or try adding one from Atom's package registry (e.g.: atom-ide-javascript, atom-typescript, ide-python, ide-rust, ide-css, ide-json)."}};var y=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)},b="object"==typeof v&&v&&v.Object===Object&&v,E="object"==typeof self&&self&&self.Object===Object&&self,w=b||E||Function("return this")(),x=function(){return w.Date.now()},L=/\s/;var P=function(t){for(var e=t.length;e--&&L.test(t.charAt(e)););return e},C=/^\s+/;var T=function(t){return t?t.slice(0,P(t)+1).replace(C,""):t},O=w.Symbol,k=Object.prototype,j=k.hasOwnProperty,S=k.toString,M=O?O.toStringTag:void 0;var A=function(t){var e=j.call(t,M),n=t[M];try{t[M]=void 0;var i=!0}catch(t){}var o=S.call(t);return i&&(e?t[M]=n:delete t[M]),o},I=Object.prototype.toString;var N=function(t){return I.call(t)},D=O?O.toStringTag:void 0;var F=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":D&&D in Object(t)?A(t):N(t)};var R=function(t){return null!=t&&"object"==typeof t};var V=function(t){return"symbol"==typeof t||R(t)&&"[object Symbol]"==F(t)},$=/^[-+]0x[0-9a-f]+$/i,H=/^0b[01]+$/i,B=/^0o[0-7]+$/i,_=parseInt;var G=function(t){if("number"==typeof t)return t;if(V(t))return NaN;if(y(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=y(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=T(t);var n=H.test(t);return n||B.test(t)?_(t.slice(2),n?2:8):$.test(t)?NaN:+t},W=Math.max,q=Math.min;var U=function(t,e,n){var i,o,r,s,a,l,d=0,c=!1,u=!1,p=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function f(e){var n=i,r=o;return i=o=void 0,d=e,s=t.apply(r,n)}function v(t){return d=t,a=setTimeout(h,e),c?f(t):s}function m(t){var n=t-l;return void 0===l||n>=e||n<0||u&&t-d>=r}function h(){var t=x();if(m(t))return g(t);a=setTimeout(h,function(t){var n=e-(t-l);return u?q(n,r-(t-d)):n}(t))}function g(t){return a=void 0,p&&i?f(t):(i=o=void 0,s)}function b(){var t=x(),n=m(t);if(i=arguments,o=this,l=t,n){if(void 0===a)return v(l);if(u)return clearTimeout(a),a=setTimeout(h,e),f(l)}return void 0===a&&(a=setTimeout(h,e)),s}return e=G(e)||0,y(n)&&(c=!!n.leading,r=(u="maxWait"in n)?W(G(n.maxWait)||0,e):r,p="trailing"in n?!!n.trailing:p),b.cancel=function(){void 0!==a&&clearTimeout(a),d=0,i=l=o=a=void 0},b.flush=function(){return void 0===a?s:g(x())},b},z={initialDisplay:{title:"Initial Outline Display",description:"Show outline initially aftern atom loads",type:"boolean",default:!0},sortEntries:{title:"Sort entries based on the line number",description:"This option sorts the entries based on where they appear in the code.",type:"boolean",default:!0},foldInitially:{title:"Fold the entries initially",description:"If enabled, the outline entries are folded initially. This is enabled automatically in large file mode.",type:"boolean",default:!1}};const J=new t.CompositeDisposable;let K;const Q=new h.ProviderRegistry;const X=atom.config.get("linter-ui-default.longLineLength")||4e3,Y=atom.config.get("linter-ui-default.largeFileLineCount")/6||3e3;function Z(t){if(t.largeFileMode)return 2e4;const e=t.getLineCount();if(e>=Y)return e;{const n=t.getBuffer();for(let t=0,i=e;t<i;t++)if(n.lineLengthForRow(t)>X)return X;return 0}}let tt;async function et(t){var e;if(void 0===t)return;null===(e=null==tt?void 0:tt.dispose)||void 0===e||e.call(tt),await ot(t);const n=Z(t),i=Math.max(n/5,300),o=U(ot,i);tt.add(t.onDidStopChanging((async()=>{await o(t)})),t.onDidDestroy((()=>{rt("noEditor")})))}function nt(){const t=atom.workspace.getActiveTextEditor();void 0!==t&&void 0!==K&&K.selectAtCursorLine(t)}async function it(){void 0===K&&(K=new o);const t=atom.workspace.paneForItem(K);if(t)return void t.destroyItem(K);const e=atom.workspace.getRightDock(),[n]=e.getPanes();n.addItem(K),n.activateItem(K),e.show();try{await et(atom.workspace.getActiveTextEditor())}catch(t){i(t)}}async function ot(t=atom.workspace.getActiveTextEditor()){var e;if(void 0===K&&(K=new o),!K.isVisible())return;if(void 0===t)return rt("noEditor");const n=Q.getProviderForEditor(t);if(!n)return rt("noProvider");const i=await n.getOutline(t);K.setOutline(null!==(e=null==i?void 0:i.outlineTrees)&&void 0!==e?e:[],t,Boolean(Z(t)))}function rt(t){null==K||K.presentStatus(g[t])}exports.activate=function(){J.add(atom.commands.add("atom-workspace","outline:toggle",it),atom.commands.add("atom-workspace","outline:reveal-cursor",nt)),function(){tt=new t.CompositeDisposable;const e=atom.workspace.observeActiveTextEditor(et);J.add(e)}(),atom.config.get("atom-ide-outline.initialDisplay")&&it().catch((t=>{i(t)}))},exports.config=z,exports.consumeOutlineProvider=async function(t){J.add(Q.addProvider(t)),await ot()},exports.deactivate=function(){var t;null===(t=null==tt?void 0:tt.dispose)||void 0===t||t.call(tt),J.dispose(),null==K||K.destroy(),K=void 0},exports.getOutline=ot,exports.outlineProviderRegistry=Q,exports.revealCursor=nt,exports.setStatus=rt,exports.statuses=g,exports.toggleOutlineView=it;
//# sourceMappingURL=main.js.map
