"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("atom");function e(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var i=e(t);function o(t){atom.notifications.addError(t.name,{stack:t.stack,detail:t.message})}class n{constructor(){this.outlineRoot=void 0,this.pointToElementsMap=new Map,this.element=document.createElement("div"),this.element.classList.add("outline-view")}destroy(){this.element.remove()}getElement(){return this.element}getTitle(){return"Outline"}getIconName(){return"list-unordered"}setOutline(t,e,i){if(void 0!==this.lastEntries&&r(t,this.lastEntries))return this.pointToElementsMap.clear(),void l(this.outlineRoot,t,e,this.pointToElementsMap);this.lastEntries=t;const o=this.clearOutline();if(o.dataset.editorRootScope=e.getRootScopeDescriptor().getScopesArray().join(" "),i){const t=document.createElement("div");t.innerHTML='\n        <span style = "\n          font-size: var(--editor-font-size);\n          font-family: var(--editor-font-family);\n          line-height: var(--editor-line-height);\n          color: #71844c;\n        "\n        >Large file mode</span>\n      ',o.appendChild(t)}this.outlineRoot=document.createElement("ul");const n=e.getTabLength();"number"==typeof n&&this.outlineRoot.style.setProperty("--editor-tab-length",Math.max(n/2,2).toString(10)),a(this.outlineRoot,t,e,i||atom.config.get("atom-ide-outline.foldInitially"),0),l(this.outlineRoot,t,e,this.pointToElementsMap),o.appendChild(this.outlineRoot)}clearOutline(){const t=this.getElement();return t.innerHTML="",t.dataset.editorRootScope="",t}presentStatus(t){this.clearOutline();const e=t&&function(t){const e=document.createElement("div");e.className="status";const{title:i="",description:o=""}=t;return e.innerHTML=`<h1>${i}</h1>\n  <span>${o}</span>`,e}(t);if(e){this.getElement().appendChild(e)}}selectAtCursorLine(t){if(!this.isVisible())return;if(c)return void(c=!1);if(void 0!==this.focusedElms)for(const t of this.focusedElms)t.toggleAttribute("cursorOn",!1);const e=t.row;if(this.focusedElms=this.pointToElementsMap.get(e),void 0!==this.focusedElms)for(const t of this.focusedElms)t.toggleAttribute("cursorOn",!0),t.scrollIntoView({block:"center"})}isVisible(){return function(t){const e=atom.workspace.paneContainerForItem(t);return void 0!==e&&("function"!=typeof e.isVisible||e.isVisible())}(this)}}function r(t,e){if(t===e)return!0;{const i=t.length;if(i!==e.length)return!1;for(let o=0;o<i;o++){const i=t[o],n=e[o];if(i.representativeName!==n.representativeName||i.plainText!==n.plainText||i.kind!==n.kind||i.icon!==n.icon||!r(i.children,n.children))return!1}}return!0}function s(t){return t.children.length>=1}function a(t,e,i,o,n){var r;!function(t){atom.config.get("atom-ide-outline.sortEntries")&&t.sort(((t,e)=>{const i=t.startPosition.row-e.startPosition.row;return 0===i?t.startPosition.column-t.startPosition.column:i}))}(e);for(const l of e){const e=document.createElement("li"),d=document.createElement("span");if(d.innerText=null!==(r=l.representativeName||l.plainText)&&void 0!==r?r:"",d.prepend(f(null==l?void 0:l.icon,null==l?void 0:l.kind)),e.appendChild(d),s(l)){const t=document.createElement("ul");t.style.setProperty("--indent-level",(n+1).toString(10)),t.addEventListener("click",(t=>t.stopPropagation()),{passive:!0}),e.appendChild(t);const r=p(t,o);d.prepend(r),a(t,l.children,i,o,n+1)}t.appendChild(e)}}function l(t,e,i,o,n){const r=t.children;for(let t=0,n=e.length;t<n;t++){const n=e[t],a=r[t];if(a.addEventListener("click",(()=>u(n.startPosition,i)),{passive:!0}),d(o,n.startPosition.row,a),s(n)){l(a.lastElementChild,n.children,i,o)}}}function d(t,e,i){const o=t.get(e);void 0!==o?(o.push(i),t.set(e,o)):t.set(e,[i])}let c=!1;function u(t,e){const i=atom.workspace.paneForItem(e);void 0!==i&&(i.activate(),e.getCursors()[0].setBufferPosition(t,{autoscroll:!0}),c=!0)}function f(t,e){const i=document.createElement("span");i.classList.add("outline-icon"),void 0===e&&void 0!==t&&(e=t);let o="ðŸž‡";if("string"==typeof e&&e.length>0){let t;0===e.indexOf("type-")?(t=`${e}`,o=e.replace("type-","")):(t=`type-${e}`,o=e),i.classList.add(t)}return i.innerHTML=`<span>${o.substring(0,3)}</span>`,i}function p(t,e){const i=document.createElement("button");return e?(t.hidden=!0,i.classList.add("outline-fold-btn","collapsed")):i.classList.add("outline-fold-btn","expanded"),i.addEventListener("click",(e=>{t.hidden=!t.hidden,t.hidden?(i.classList.remove("expanded"),i.classList.add("collapsed")):(i.classList.remove("collapsed"),i.classList.add("expanded")),e.stopPropagation()}),{passive:!0}),i}var v="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var m,h=(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.ProviderRegistry=void 0,e.ProviderRegistry=class{constructor(){this.providers=[]}addProvider(t){const e=this.providers.findIndex((e=>t.priority>e.priority));return-1===e?this.providers.push(t):this.providers.splice(e,0,t),new i.default.Disposable((()=>{this.removeProvider(t)}))}removeProvider(t){const e=this.providers.indexOf(t);-1!==e&&this.providers.splice(e,1)}getProviderForEditor(t){const e=t.getGrammar().scopeName;return this.findProvider(e)}getAllProvidersForEditor(t){const e=t.getGrammar().scopeName;return this.findAllProviders(e)}findProvider(t){for(const e of this.findAllProviders(t))return e;return null}*findAllProviders(t){for(const e of this.providers)null!=e.grammarScopes&&-1===e.grammarScopes.indexOf(t)||(yield e)}}}(m={exports:{}},m.exports),m.exports);const g={noEditor:{title:"Outline is unavailable.",description:"Open a text editor."},noProvider:{title:"Provider is unavailable",description:"Looks like a provider for this type of file is not available. Check if a relevant IDE language package is installed and has outline support, or try adding one from Atom's package registry (e.g.: atom-ide-javascript, atom-typescript, ide-python, ide-rust, ide-css, ide-json)."}};var y=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)},b="object"==typeof v&&v&&v.Object===Object&&v,E="object"==typeof self&&self&&self.Object===Object&&self,w=b||E||Function("return this")(),x=function(){return w.Date.now()},P=/\s/;var T=function(t){for(var e=t.length;e--&&P.test(t.charAt(e)););return e},O=/^\s+/;var L=function(t){return t?t.slice(0,T(t)+1).replace(O,""):t},k=w.Symbol,j=Object.prototype,S=j.hasOwnProperty,C=j.toString,M=k?k.toStringTag:void 0;var R=function(t){var e=S.call(t,M),i=t[M];try{t[M]=void 0;var o=!0}catch(t){}var n=C.call(t);return o&&(e?t[M]=i:delete t[M]),n},A=Object.prototype.toString;var I=function(t){return A.call(t)},D=k?k.toStringTag:void 0;var N=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":D&&D in Object(t)?R(t):I(t)};var F=function(t){return null!=t&&"object"==typeof t};var $=function(t){return"symbol"==typeof t||F(t)&&"[object Symbol]"==N(t)},V=/^[-+]0x[0-9a-f]+$/i,B=/^0b[01]+$/i,H=/^0o[0-7]+$/i,_=parseInt;var z=function(t){if("number"==typeof t)return t;if($(t))return NaN;if(y(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=y(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=L(t);var i=B.test(t);return i||H.test(t)?_(t.slice(2),i?2:8):V.test(t)?NaN:+t},G=Math.max,W=Math.min;var q=function(t,e,i){var o,n,r,s,a,l,d=0,c=!1,u=!1,f=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function p(e){var i=o,r=n;return o=n=void 0,d=e,s=t.apply(r,i)}function v(t){return d=t,a=setTimeout(h,e),c?p(t):s}function m(t){var i=t-l;return void 0===l||i>=e||i<0||u&&t-d>=r}function h(){var t=x();if(m(t))return g(t);a=setTimeout(h,function(t){var i=e-(t-l);return u?W(i,r-(t-d)):i}(t))}function g(t){return a=void 0,f&&o?p(t):(o=n=void 0,s)}function b(){var t=x(),i=m(t);if(o=arguments,n=this,l=t,i){if(void 0===a)return v(l);if(u)return clearTimeout(a),a=setTimeout(h,e),p(l)}return void 0===a&&(a=setTimeout(h,e)),s}return e=z(e)||0,y(i)&&(c=!!i.leading,r=(u="maxWait"in i)?G(z(i.maxWait)||0,e):r,f="trailing"in i?!!i.trailing:f),b.cancel=function(){void 0!==a&&clearTimeout(a),d=0,o=l=n=a=void 0},b.flush=function(){return void 0===a?s:g(x())},b},U={initialDisplay:{title:"Initial Outline Display",description:"Show outline initially aftern atom loads",type:"boolean",default:!0},sortEntries:{title:"Sort entries based on the line number",description:"This option sorts the entries based on where they appear in the code.",type:"boolean",default:!0},foldInitially:{title:"Fold the entries initially",description:"If enabled, the outline entries are folded initially. This is enabled automatically in large file mode.",type:"boolean",default:!1}};const J=new t.CompositeDisposable;let K;const Q=new h.ProviderRegistry;const X=atom.config.get("linter-ui-default.longLineLength")||4e3,Y=atom.config.get("linter-ui-default.largeFileLineCount")/6||3e3;function Z(t){if(t.largeFileMode)return 2e4;const e=t.getLineCount();if(e>=Y)return e;{const i=t.getBuffer();for(let t=0,o=e;t<o;t++)if(i.lineLengthForRow(t)>X)return X;return 0}}let tt;async function et(t){var e;if(void 0===t)return;null===(e=null==tt?void 0:tt.dispose)||void 0===e||e.call(tt),await nt(t);const i=Z(t),o=Math.max(i/5,300),n=q(nt,o);tt.add(t.onDidStopChanging((async()=>{await n(t)})),t.onDidDestroy((()=>{rt("noEditor")})))}function it(){const t=atom.workspace.getActiveTextEditor();void 0!==t&&void 0!==K&&K.selectAtCursorLine(t.getCursorBufferPosition())}async function ot(){void 0===K&&(K=new n);const t=atom.workspace.paneForItem(K);if(t)return void t.destroyItem(K);const e=atom.workspace.getRightDock(),[i]=e.getPanes();i.addItem(K),i.activateItem(K),e.show();try{await et(atom.workspace.getActiveTextEditor())}catch(t){o(t)}}async function nt(t=atom.workspace.getActiveTextEditor()){var e;if(void 0===K&&(K=new n),!K.isVisible())return;if(void 0===t)return rt("noEditor");const i=Q.getProviderForEditor(t);if(!i)return rt("noProvider");const o=await i.getOutline(t);K.setOutline(null!==(e=null==o?void 0:o.outlineTrees)&&void 0!==e?e:[],t,Boolean(Z(t)))}function rt(t){null==K||K.presentStatus(g[t])}exports.activate=function(){J.add(atom.commands.add("atom-workspace","outline:toggle",ot),atom.commands.add("atom-workspace","outline:reveal-cursor",it)),function(){tt=new t.CompositeDisposable;const e=atom.workspace.observeActiveTextEditor(et);J.add(e)}(),atom.config.get("atom-ide-outline.initialDisplay")&&ot().catch((t=>{o(t)}))},exports.config=U,exports.consumeOutlineProvider=async function(t){J.add(Q.addProvider(t)),await nt()},exports.deactivate=function(){var t;null===(t=null==tt?void 0:tt.dispose)||void 0===t||t.call(tt),J.dispose(),null==K||K.destroy(),K=void 0},exports.getOutline=nt,exports.outlineProviderRegistry=Q,exports.revealCursor=it,exports.setStatus=rt,exports.statuses=g,exports.toggleOutlineView=ot;
//# sourceMappingURL=main.js.map
