"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("atom");function e(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var i=e(t);function n(t){atom.notifications.addError(t.name,{stack:t.stack,detail:t.message})}class o{constructor(){this.outlineList=void 0,this.pointToElementsMap=new Map,this.element=document.createElement("div"),this.outlineContent=document.createElement("div"),this.element.appendChild(this.outlineContent),this.outlineContent.classList.add("outline-content")}destroy(){this.element.remove()}getElement(){return this.element}getTitle(){return"Outline"}getIconName(){return"list-unordered"}setOutline(t,e,i){if(void 0!==this.lastEntries&&r(t,this.lastEntries))return this.pointToElementsMap.clear(),void l(this.outlineList,t,e,this.pointToElementsMap);this.lastEntries=t,this.clearContent(),i&&this.outlineContent.appendChild(function(){const t=document.createElement("div");return t.innerHTML='<span class="large-file-mode">Large file mode</span>',t}()),this.outlineList=function(t,e,i,n){const o=document.createElement("ul");o.dataset.editorRootScope=e.getRootScopeDescriptor().getScopesArray().join(" ");const r=e.getTabLength();"number"==typeof r&&o.style.setProperty("--editor-tab-length",Math.max(r/2,2).toString(10));return a(o,t,e,i||atom.config.get("atom-ide-outline.foldInitially"),0),l(o,t,e,n),o}(t,e,i,this.pointToElementsMap),this.outlineContent.appendChild(this.outlineList)}clearContent(){this.outlineContent.innerHTML="",void 0!==this.outlineList&&(this.outlineList.dataset.editorRootScope=""),this.lastEntries=void 0}presentStatus(t){this.clearContent();const e=t&&function(t){const e=document.createElement("div");e.className="status";const{title:i="",description:n=""}=t;return e.innerHTML=`<h1>${i}</h1>\n  <span>${n}</span>`,e}(t);e&&this.outlineContent.appendChild(e)}selectAtCursorLine(t){if(!this.isVisible())return;if(c)return void(c=!1);if(void 0!==this.focusedElms)for(const t of this.focusedElms)t.toggleAttribute("cursorOn",!1);const e=t.row;if(this.focusedElms=this.pointToElementsMap.get(e),void 0!==this.focusedElms)for(const t of this.focusedElms)t.toggleAttribute("cursorOn",!0),t.scrollIntoView({block:"center"})}isVisible(){return function(t){const e=atom.workspace.paneContainerForItem(t);return void 0!==e&&("function"!=typeof e.isVisible||e.isVisible())}(this)}}function r(t,e){if(t===e)return!0;{const i=t.length;if(i!==e.length)return!1;for(let n=0;n<i;n++){const i=t[n],o=e[n];if(i.representativeName!==o.representativeName||i.plainText!==o.plainText||i.kind!==o.kind||i.icon!==o.icon||!r(i.children,o.children))return!1}}return!0}function s(t){return t.children.length>=1}function a(t,e,i,n,o){var r;!function(t){atom.config.get("atom-ide-outline.sortEntries")&&t.sort(((t,e)=>{const i=t.startPosition.row-e.startPosition.row;return 0===i?t.startPosition.column-t.startPosition.column:i}))}(e);for(const l of e){const e=document.createElement("li"),d=document.createElement("span");if(d.innerText=null!==(r=l.representativeName||l.plainText)&&void 0!==r?r:"",d.prepend(p(null==l?void 0:l.icon,null==l?void 0:l.kind)),e.appendChild(d),s(l)){const t=document.createElement("ul");t.style.setProperty("--indent-level",(o+1).toString(10)),t.addEventListener("click",(t=>t.stopPropagation()),{passive:!0}),e.appendChild(t);const r=f(t,n);d.prepend(r),a(t,l.children,i,n,o+1)}t.appendChild(e)}}function l(t,e,i,n,o){const r=t.children;for(let t=0,o=e.length;t<o;t++){const o=e[t],a=r[t];if(a.addEventListener("click",(()=>u(o.startPosition,i)),{passive:!0}),d(n,o.startPosition.row,a),s(o)){l(a.lastElementChild,o.children,i,n)}}}function d(t,e,i){const n=t.get(e);void 0!==n?(n.push(i),t.set(e,n)):t.set(e,[i])}let c=!1;function u(t,e){const i=atom.workspace.paneForItem(e);void 0!==i&&(i.activate(),e.getCursors()[0].setBufferPosition(t,{autoscroll:!0}),c=!0)}function p(t,e){const i=document.createElement("span");i.classList.add("outline-icon"),void 0===e&&void 0!==t&&(e=t);let n="ðŸž‡";if("string"==typeof e&&e.length>0){let t;0===e.indexOf("type-")?(t=`${e}`,n=e.replace("type-","")):(t=`type-${e}`,n=e),i.classList.add(t)}return i.innerHTML=`<span>${n.substring(0,3)}</span>`,i}function f(t,e){const i=document.createElement("button");return e?(t.hidden=!0,i.classList.add("outline-fold-btn","collapsed")):i.classList.add("outline-fold-btn","expanded"),i.addEventListener("click",(e=>{t.hidden=!t.hidden,t.hidden?(i.classList.remove("expanded"),i.classList.add("collapsed")):(i.classList.remove("collapsed"),i.classList.add("expanded")),e.stopPropagation()}),{passive:!0}),i}var v="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var m,h=(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.ProviderRegistry=void 0,e.ProviderRegistry=class{constructor(){this.providers=[]}addProvider(t){const e=this.providers.findIndex((e=>t.priority>e.priority));return-1===e?this.providers.push(t):this.providers.splice(e,0,t),new i.default.Disposable((()=>{this.removeProvider(t)}))}removeProvider(t){const e=this.providers.indexOf(t);-1!==e&&this.providers.splice(e,1)}getProviderForEditor(t){const e=t.getGrammar().scopeName;return this.findProvider(e)}getAllProvidersForEditor(t){const e=t.getGrammar().scopeName;return this.findAllProviders(e)}findProvider(t){for(const e of this.findAllProviders(t))return e;return null}*findAllProviders(t){for(const e of this.providers)null!=e.grammarScopes&&-1===e.grammarScopes.indexOf(t)||(yield e)}}}(m={exports:{}},m.exports),m.exports);const g={noEditor:{title:"Outline is unavailable.",description:"Open a text editor."},noProvider:{title:"Provider is unavailable",description:"Looks like a provider for this type of file is not available. Check if a relevant IDE language package is installed and has outline support, or try adding one from Atom's package registry (e.g.: atom-ide-javascript, atom-typescript, ide-python, ide-rust, ide-css, ide-json)."}};var y=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)},b="object"==typeof v&&v&&v.Object===Object&&v,E="object"==typeof self&&self&&self.Object===Object&&self,w=b||E||Function("return this")(),x=function(){return w.Date.now()},P=/\s/;var T=function(t){for(var e=t.length;e--&&P.test(t.charAt(e)););return e},L=/^\s+/;var C=function(t){return t?t.slice(0,T(t)+1).replace(L,""):t},O=w.Symbol,k=Object.prototype,j=k.hasOwnProperty,S=k.toString,M=O?O.toStringTag:void 0;var A=function(t){var e=j.call(t,M),i=t[M];try{t[M]=void 0;var n=!0}catch(t){}var o=S.call(t);return n&&(e?t[M]=i:delete t[M]),o},I=Object.prototype.toString;var D=function(t){return I.call(t)},N=O?O.toStringTag:void 0;var F=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":N&&N in Object(t)?A(t):D(t)};var R=function(t){return null!=t&&"object"==typeof t};var $=function(t){return"symbol"==typeof t||R(t)&&"[object Symbol]"==F(t)},V=/^[-+]0x[0-9a-f]+$/i,B=/^0b[01]+$/i,H=/^0o[0-7]+$/i,_=parseInt;var G=function(t){if("number"==typeof t)return t;if($(t))return NaN;if(y(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=y(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=C(t);var i=B.test(t);return i||H.test(t)?_(t.slice(2),i?2:8):V.test(t)?NaN:+t},W=Math.max,q=Math.min;var U=function(t,e,i){var n,o,r,s,a,l,d=0,c=!1,u=!1,p=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function f(e){var i=n,r=o;return n=o=void 0,d=e,s=t.apply(r,i)}function v(t){return d=t,a=setTimeout(h,e),c?f(t):s}function m(t){var i=t-l;return void 0===l||i>=e||i<0||u&&t-d>=r}function h(){var t=x();if(m(t))return g(t);a=setTimeout(h,function(t){var i=e-(t-l);return u?q(i,r-(t-d)):i}(t))}function g(t){return a=void 0,p&&n?f(t):(n=o=void 0,s)}function b(){var t=x(),i=m(t);if(n=arguments,o=this,l=t,i){if(void 0===a)return v(l);if(u)return clearTimeout(a),a=setTimeout(h,e),f(l)}return void 0===a&&(a=setTimeout(h,e)),s}return e=G(e)||0,y(i)&&(c=!!i.leading,r=(u="maxWait"in i)?W(G(i.maxWait)||0,e):r,p="trailing"in i?!!i.trailing:p),b.cancel=function(){void 0!==a&&clearTimeout(a),d=0,n=l=o=a=void 0},b.flush=function(){return void 0===a?s:g(x())},b},z={initialDisplay:{title:"Initial Outline Display",description:"Show outline initially aftern atom loads",type:"boolean",default:!0},sortEntries:{title:"Sort entries based on the line number",description:"This option sorts the entries based on where they appear in the code.",type:"boolean",default:!0},foldInitially:{title:"Fold the entries initially",description:"If enabled, the outline entries are folded initially. This is enabled automatically in large file mode.",type:"boolean",default:!1}};const J=new t.CompositeDisposable;let K;const Q=new h.ProviderRegistry;const X=atom.config.get("linter-ui-default.longLineLength")||4e3,Y=atom.config.get("linter-ui-default.largeFileLineCount")/6||3e3;function Z(t){if(t.largeFileMode)return 2e4;const e=t.getLineCount();if(e>=Y)return e;{const i=t.getBuffer();for(let t=0,n=e;t<n;t++)if(i.lineLengthForRow(t)>X)return X;return 0}}let tt;async function et(t){var e;if(void 0===t)return;null===(e=null==tt?void 0:tt.dispose)||void 0===e||e.call(tt),await ot(t);const i=Z(t),n=Math.max(i/5,300),o=U(ot,n);tt.add(t.onDidStopChanging((async()=>{await o(t)})),t.onDidDestroy((()=>{rt("noEditor")})))}function it(){const t=atom.workspace.getActiveTextEditor();void 0!==t&&void 0!==K&&K.selectAtCursorLine(t.getCursorBufferPosition())}async function nt(){void 0===K&&(K=new o);const t=atom.workspace.paneForItem(K);if(t)return void t.destroyItem(K);const e=atom.workspace.getRightDock(),[i]=e.getPanes();i.addItem(K),i.activateItem(K),e.show();try{await et(atom.workspace.getActiveTextEditor())}catch(t){n(t)}}async function ot(t=atom.workspace.getActiveTextEditor()){var e;if(void 0===K&&(K=new o),!K.isVisible())return;if(void 0===t)return rt("noEditor");const i=Q.getProviderForEditor(t);if(!i)return rt("noProvider");const n=await i.getOutline(t);K.setOutline(null!==(e=null==n?void 0:n.outlineTrees)&&void 0!==e?e:[],t,Boolean(Z(t)))}function rt(t){null==K||K.presentStatus(g[t])}exports.activate=function(){J.add(atom.commands.add("atom-workspace","outline:toggle",nt),atom.commands.add("atom-workspace","outline:reveal-cursor",it)),function(){tt=new t.CompositeDisposable;const e=atom.workspace.observeActiveTextEditor(et);J.add(e)}(),atom.config.get("atom-ide-outline.initialDisplay")&&nt().catch((t=>{n(t)}))},exports.config=z,exports.consumeOutlineProvider=async function(t){J.add(Q.addProvider(t)),await ot()},exports.deactivate=function(){var t;null===(t=null==tt?void 0:tt.dispose)||void 0===t||t.call(tt),J.dispose(),null==K||K.destroy(),K=void 0},exports.getOutline=ot,exports.outlineProviderRegistry=Q,exports.revealCursor=it,exports.setStatus=rt,exports.statuses=g,exports.toggleOutlineView=nt;
//# sourceMappingURL=main.js.map
